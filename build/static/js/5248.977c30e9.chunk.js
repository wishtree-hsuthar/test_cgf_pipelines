"use strict";(self.webpackChunkpr74_cgf_hrdd_web_front=self.webpackChunkpr74_cgf_hrdd_web_front||[]).push([[5248],{25248:(e,s,a)=>{a.r(s),a.d(s,{default:()=>S});var l=a(97275),t=a(88970),i=a(85523),r=a(61419),d=a(697),n=a(35527),c=a(39281),o=a(79836),m=a(53382),h=a(35855),u=a(53994),x=a(94454),p=a(72791),g=a(61134),v=a(57689),b=a(11087),j=a(55294),f=a(28386),N=a(14917),w=a(27659),y=(a(71605),a(12820)),Z=a(76218),k=a(1260),M=a(14227),T=a(45736),C=a(80184);const S=()=>{(0,k.j)("Add Role");const e=(0,v.s0)(),s=p.useRef(),[a,S]=(0,y.Z)({titleMessage:"",descriptionMessage:"",messageType:"success"});let A=[],E={};const L={roleName:"",status:"active",description:""},_={roleName:{required:"Enter the role name",maxLength:"Max char limit exceed",minLength:"minimum 3 characters required",pattern:"Invalid format"},description:{required:"Enter the description",maxLength:"Max char limit exceed",minLength:"minimum 3 characters required"}},[R,O]=(0,p.useState)({...E}),[D,q]=(0,p.useState)(!1),[I,P]=(0,p.useState)(!1),Y=e=>{e.map(((e,s)=>A[s]={moduleName:e.name,moduleId:e._id})),A.forEach((e=>E[e.moduleId]={name:e.moduleName,fill:!1,list:!1,add:!1,edit:!1,view:!1,delete:!1,all:!1})),O({...E})},{control:F,reset:Q,setValue:V,handleSubmit:z}=(0,g.cI)({defaultValues:L}),B=async a=>{N.Y.info("Add role - submitCall handler");try{let e=JSON.parse(JSON.stringify(R));if(Object.keys(e).forEach((s=>{delete e[s].all,delete e[s].name})),c=e,!Object.values(c).some((e=>Object.values(e).some((e=>e)))))return void S({titleMessage:"Hurray!",descriptionMessage:"Select atleast 1 privilege",messageType:"error"},(()=>s.current()));q(!0),P(!0);const l=await j.Z.post(Z.Yn+"roles",{name:a.roleName,description:a.description,isActive:"active"===a.status,privileges:e});if(201==l.status)return P(!1),q(!1),S({titleMessage:"Hurray!",descriptionMessage:l.data.message,messageType:"success"},(()=>s.current())),Q({...L}),H(),!0}catch(o){var l,t;if(P(!1),q(!1),401==(null===o||void 0===o||null===(l=o.response)||void 0===l?void 0:l.status))S({titleMessage:"Error",descriptionMessage:"Session Timeout: Please login again",messageType:"error"},(()=>s.current())),setTimeout((()=>{e("/login")}),3e3);else{if(403!==(null===o||void 0===o||null===(t=o.response)||void 0===t?void 0:t.status))return(e=>{var a,l;N.Y.info("Add role - setErrorToaster handler"),S({titleMessage:"Error",descriptionMessage:null!==e&&void 0!==e&&null!==(a=e.response)&&void 0!==a&&null!==(l=a.data)&&void 0!==l&&l.message&&"string"===typeof e.response.data.message?e.response.data.message:"Oops! Something went wrong. Please try again later.",messageType:"error"},(()=>s.current()))})(o),!1;var i,r,d,n;S({titleMessage:"Error",descriptionMessage:null!==o&&void 0!==o&&null!==(i=o.response)&&void 0!==i&&null!==(r=i.data)&&void 0!==r&&r.message?null===o||void 0===o||null===(d=o.response)||void 0===d||null===(n=d.data)||void 0===n?void 0:n.message:"Oops! Something went wrong. Please try again later.",messageType:"error"},(()=>s.current())),setTimeout((()=>{e("/home")}),3e3)}}var c},H=async()=>{try{const{data:e}=await j.Z.get(Z.Yn+"system-modules");Y([...e])}catch(a){if("ERR_CANCELED"===(null===a||void 0===a?void 0:a.code))return;(0,T.K)(a,S,s,e)}};return(0,p.useEffect)((()=>{let e=!0;const s=new AbortController;return e&&H(),()=>{e=!1,s.abort()}}),[]),(0,C.jsxs)("div",{className:"page-wrapper",children:[(0,C.jsx)(w.Z,{myRef:s,titleMessage:a.titleMessage,descriptionMessage:a.descriptionMessage,messageType:a.messageType}),(0,C.jsx)("div",{className:"breadcrumb-wrapper",children:(0,C.jsx)("div",{className:"container",children:(0,C.jsxs)("ul",{className:"breadcrumb",children:[(0,C.jsx)("li",{children:(0,C.jsx)(b.rU,{to:"/roles",children:"Roles"})}),(0,C.jsx)("li",{children:"Add Role"})]})})}),(0,C.jsx)("section",{children:(0,C.jsxs)("div",{className:"container",children:[(0,C.jsxs)("div",{className:"form-header flex-between",children:[(0,C.jsx)("h2",{className:"heading2",children:"Add Role"}),(0,C.jsx)("div",{className:"form-header-right-txt",children:(0,C.jsxs)("div",{className:"tertiary-btn-blk",onClick:z((async e=>{B(e)})),children:[(0,C.jsx)("span",{className:"addmore-icon",children:(0,C.jsx)("i",{className:"fa fa-plus"})}),(0,C.jsx)("span",{className:"addmore-txt",children:"Save & Add More"})]})})]}),(0,C.jsx)("form",{onSubmit:z((async s=>{await B(s)&&setTimeout((()=>e("/roles")),3e3)})),children:I?(0,C.jsx)(f.Z,{}):(0,C.jsxs)("div",{className:"card-wrapper",children:[(0,C.jsxs)("div",{className:"card-blk flex-between",children:[(0,C.jsx)("div",{className:"card-form-field",children:(0,C.jsxs)("div",{className:"form-group",children:[(0,C.jsxs)("label",{htmlFor:"roleName",children:["Role Name ",(0,C.jsx)("span",{className:"mandatory",children:"*"})]}),(0,C.jsx)(g.Qr,{name:"roleName",rules:{required:!0,maxLength:50,minLength:3,pattern:/^[a-zA-Z][a-zA-Z ]*$/},control:F,render:e=>{let{field:s,fieldState:{error:a}}=e;return(0,C.jsx)(l.Z,{...s,onBlur:e=>V("roleName",e.target.value.trim()),inputProps:{maxLength:50},className:"input-field ".concat(a&&"input-error"),id:"outlined-basic",placeholder:"Enter role name",helperText:a?_.roleName[a.type]:" ",variant:"outlined"})}})]})}),(0,C.jsx)("div",{className:"card-form-field",children:(0,C.jsxs)("div",{className:"form-group",children:[(0,C.jsx)("label",{htmlFor:"status",children:"Status"}),(0,C.jsx)("div",{className:"radio-btn-field",children:(0,C.jsx)(g.Qr,{name:"status",control:F,render:e=>{let{field:s}=e;return(0,C.jsxs)(t.Z,{...s,"aria-labelledby":"demo-radio-buttons-group-label",name:"radio-buttons-group",className:"radio-btn",children:[(0,C.jsx)(i.Z,{value:"active",control:(0,C.jsx)(r.Z,{}),label:"Active"}),(0,C.jsx)(i.Z,{value:"inactive",control:(0,C.jsx)(r.Z,{}),label:"Inactive"})]})}})})]})}),(0,C.jsx)("div",{className:"card-form-field fullwidth",children:(0,C.jsxs)("div",{className:"form-group",children:[(0,C.jsxs)("label",{htmlFor:"addrole-description",children:["Description ",(0,C.jsx)("span",{className:"mandatory",children:"*"})]}),(0,C.jsx)(g.Qr,{name:"description",control:F,rules:{required:!0,maxLength:500,minLength:3},render:e=>{let{field:s,fieldState:{error:a}}=e;return(0,C.jsx)(l.Z,{multiline:!0,...s,onBlur:e=>V("description",e.target.value.trim()),inputProps:{maxLength:500},className:"input-textarea ".concat(a&&"input-textarea-error"),id:"outlined-basic",placeholder:"Enter description",helperText:a?_.description[a.type]:" ",variant:"outlined"})}})]})})]}),(0,C.jsx)(d.Z,{sx:{width:"100%"},className:"table-blk table-blk-role",children:(0,C.jsx)(n.Z,{sx:{width:"100%"},children:(0,C.jsx)(c.Z,{children:(0,C.jsxs)(o.Z,{sx:{minWidth:750},children:[(0,C.jsx)(M.Z,{}),(0,C.jsx)(m.Z,{children:Object.keys(R).map(((e,s)=>(0,C.jsxs)(h.Z,{hover:!0,children:[(0,C.jsx)(u.Z,{children:R[e].name}),(0,C.jsx)(u.Z,{align:"center",padding:"checkbox",children:"Assessment"===R[e].name&&(0,C.jsx)(x.Z,{disabled:"Assessment"!=R[e].name,className:"table-checkbox",checked:R[e].fill,onChange:()=>O((s=>({...s,[e]:{...s[e],fill:!s[e].fill,list:s[e].list||!s[e].fill,view:s[e].view||!s[e].fill,all:!s[e].fill&&s[e].add&&s[e].edit&&s[e].delete}})))})}),(0,C.jsx)(u.Z,{align:"center",padding:"checkbox",children:"Dashboard"!==R[e].name&&(0,C.jsx)(x.Z,{className:"table-checkbox",checked:R[e].list,onChange:()=>O((s=>({...s,[e]:{...s[e],list:!s[e].list,view:s[e].view&&!s[e].list||!1,edit:s[e].edit&&!s[e].list||!1,delete:s[e].delete&&!s[e].list||!1,add:s[e].add&&!s[e].list||!1,fill:s[e].fill&&!s[e].list||!1,all:!s[e].list&&s[e].add&&s[e].edit&&s[e].view&&s[e].delete}})))})}),(0,C.jsx)(u.Z,{align:"center",padding:"checkbox",children:"Dashboard"!==R[e].name&&(0,C.jsx)(x.Z,{className:"table-checkbox",checked:R[e].add,onChange:()=>O((s=>({...s,[e]:{...s[e],add:!s[e].add,list:s[e].list||!s[e].add,view:s[e].view||!s[e].add,all:!s[e].add&&s[e].edit&&s[e].delete}})))})}),(0,C.jsx)(u.Z,{align:"center",padding:"checkbox",children:"Dashboard"!==R[e].name&&(0,C.jsx)(x.Z,{className:"table-checkbox",checked:R[e].edit,onChange:()=>O((s=>({...s,[e]:{...s[e],edit:!s[e].edit,list:s[e].list||!s[e].edit,view:s[e].view||!s[e].edit,all:s[e].add&&!s[e].edit&&s[e].delete}})))})}),(0,C.jsx)(u.Z,{align:"center",padding:"checkbox",children:(0,C.jsx)(x.Z,{className:"table-checkbox",checked:R[e].view,onChange:()=>O((s=>({...s,[e]:{...s[e],view:!s[e].view,list:s[e].list||!s[e].view,edit:s[e].edit&&!s[e].view||!1,delete:s[e].delete&&!s[e].view||!1,fill:s[e].fill&&!s[e].view||!1,all:s[e].add&&s[e].edit&&!s[e].view&&s[e].delete}})))})}),(0,C.jsx)(u.Z,{align:"center",padding:"checkbox",children:"Dashboard"!==R[e].name&&(0,C.jsx)(x.Z,{className:"table-checkbox",checked:R[e].delete,onChange:()=>O((s=>({...s,[e]:{...s[e],delete:!s[e].delete,list:s[e].list||!s[e].delete,edit:s[e].edit||!s[e].delete,view:s[e].view||!s[e].delete,all:s[e].add&&!s[e].delete}})))})}),(0,C.jsx)(u.Z,{align:"center",padding:"checkbox",children:"Dashboard"!==R[e].name&&(0,C.jsx)(x.Z,{className:"table-checkbox",checked:R[e].all,onChange:()=>O((s=>({...s,[e]:{...s[e],all:!s[e].all,list:!s[e].all,view:!s[e].all,add:!s[e].all,edit:!s[e].all,delete:!s[e].all,fill:"Assessment"===R[e].name&&!s[e].all}})))})})]},e)))})]})})})}),(0,C.jsxs)("div",{className:"form-btn flex-between add-members-btn",children:[(0,C.jsx)("button",{type:"reset",style:{marginTop:"20px"},className:"secondary-button mr-10",onClick:()=>(Q({defaultValues:L}),e("/roles")),children:"Cancel"}),(0,C.jsx)("button",{type:"submit",className:"primary-button",style:{marginTop:"20px"},disabled:D,children:"Save"})]})]})})]})})]})}}}]);
//# sourceMappingURL=5248.977c30e9.chunk.js.map