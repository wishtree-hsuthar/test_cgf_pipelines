"use strict";(self.webpackChunkpr74_cgf_hrdd_web_front=self.webpackChunkpr74_cgf_hrdd_web_front||[]).push([[2517],{42517:(e,s,a)=>{a.r(s),a.d(s,{default:()=>T});var t=a(52898),n=a(97275),r=a(94294),i=a(51514),l=a(72791),d=a(61134),o=a(57689),c=a(11087),m=a(94677),u=a(76218),p=a(46363),h=a(48086),g=a(27181),v=a(12820),x=a(27954),f=a(7792),b=a(36571),y=a(55294),j=a(71300),M=a(1260),N=a(28386),A=a(14917),C=a(45736),w=a(59434),D=a(40600),k=a(29823),E=a(80184);const S={title:{required:"Enter the assessment title",minLength:"minimum 3 characters required"},assessmentType:{required:"Select the assessment type"},assignedMember:{required:"Select the member company"},assignedOperationMember:{required:"Select the operation member"},region:{required:"Select the region"},country:{required:"Select the country"},dueDate:{required:"Select the due date"},remarks:{minLength:"minimum 3 characters required",maxLength:"Reached max limit"}};const T=function(){(0,M.j)("Edit Assessment");const[e,s]=(0,l.useState)(!1),{handleSubmit:a,control:T,setValue:P,reset:Z,watch:O,trigger:_}=(0,d.cI)({defaultValues:{title:"",assessmentType:"",assignedMember:{_id:"",name:""},assignedOperationMember:"",dueDate:"",remarks:"",region:"",country:"",actionPlan:"",deleteActionPlan:!1}}),H=(0,o.s0)(),q=(0,o.UO)(),R=(0,l.useRef)(),[Y,I]=(0,l.useState)([]),[B,F]=(0,l.useState)([]),[L,z]=(0,l.useState)([]),[U,K]=(0,v.Z)({titleMessage:"",descriptionMessage:"",messageType:"success"}),[Q,G]=(0,l.useState)([]),[V,W]=(0,l.useState)([]),[X,$]=(0,l.useState)([]),[J,ee]=(0,l.useState)([]),[se,ae]=(0,l.useState)(""),[te,ne]=(0,l.useState)(),[re,ie]=(0,l.useState)(!1),[le,de]=(0,l.useState)(!1),[oe,ce]=(0,l.useState)(null),[me,ue]=(0,l.useState)(""),pe=[".doc",".pdf",".docx",".xlsx",".xls"],he=async(e,s)=>{A.Y.info("Edit Assessment - fetchOperationMembersAccordingToMemberCompanyForAddAssessment handler");try{const a=await m.H.get(u.C+e+"/master");W(a.data.map((e=>({_id:e._id,name:e.name}))));let t=a.data.filter((e=>null===e||void 0===e?void 0:e.isMemberRepresentative));P("assignedOperationMember",s?"":t[0]._id)}catch(a){A.Y.info("Edit Assessment - fetchOperationMembersAccordingToMemberCompanyForAddAssessment handler catch error")}},ge=(0,w.v9)((e=>{var s;return null===e||void 0===e||null===(s=e.user)||void 0===s?void 0:s.userObj})),{isMemberRepresentative:ve,isOperationMember:xe,memberId:fe}=ge;(0,l.useEffect)((()=>{let e=!0;const a=new AbortController;je(a,e);(async()=>{A.Y.info("Edit Assessment - fetchAssessment handler");try{var t,n,r,i,l;s(!0);const d=await m.H.get(u.IG+q.id,{signal:a.signal});s(!1),e&&Z({title:d.data.title,assessmentType:d.data.assessmentType,assignedMember:null===(t=d.data.assignedMember)||void 0===t?void 0:t._id,assignedOperationMember:null===(n=d.data.assignedOperationMember)||void 0===n?void 0:n._id,dueDate:new Date(new Date(d.data.dueDate)).setDate(new Date(d.data.dueDate).getDate()-1),remarks:d.data.remarks,questionnaireId:d.data.questionnaireId,region:d.data.region,country:d.data.country,actionPlan:d.data.actionPlan}),ue(null===d||void 0===d||null===(r=d.data)||void 0===r?void 0:r.actionPlan);const o=await be(null===d||void 0===d||null===(i=d.data)||void 0===i?void 0:i.region),c=ye(o.data);F([...c]),ae(d.data.questionnaireId),Me(null===(l=d.data.assignedMember)||void 0===l?void 0:l._id)}catch(d){if(A.Y.info("Edit Assessment - fetchAssessment handler catch error"),"ERR_CANCELED"===(null===d||void 0===d?void 0:d.code))return;(0,C.K)(d,K,R,H,"/assessment-list"),s(!1)}})();(async()=>{A.Y.info("Edit Assessment - fetchMemberCompaniesForAddAssesments handler");try{const s=await m.H.get(ve||xe?"".concat(u.e7).concat(fe):u.rm,{signal:a.signal});e&&G(s.data.map((e=>({_id:e._id,name:e.companyName}))))}catch(s){A.Y.info("Edit Assessment - fetchMemberCompaniesForAddAssesments handler catch error")}})();return(async()=>{A.Y.info("Edit Assessment - fetchQuestionnaires handler");try{const s=await m.H.get(u.ZW+"/master",{signal:a.signal});e&&$(s.data.map((e=>e.title))),ee(s.data.map((e=>({_id:e.uuid,name:e.title}))))}catch(s){A.Y.info("Edit Assessment - fetchQuestionnaires handler catch error")}})(),()=>{e=!1,a.abort()}}),[]);const be=async e=>{A.Y.info("Add member - getCountriesAddMember handler");try{return await m.H.get(u.rF+"/".concat(e))}catch(t){var s,a;if("ERR_CANCELED"===(null===t||void 0===t?void 0:t.code))return;return A.Y.info("Add member - getCountriesAddMember handler catch error - ".concat(null===t||void 0===t||null===(s=t.response)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.message," ")),[]}},ye=e=>(e.forEach(((s,a)=>e[a]=s.hasOwnProperty("_id")?s.name:s)),e),je=async(e,s)=>{try{const s=await m.H.get(u.Up,{signal:e.signal});return I(s.data),Y}catch(d){var a,t;if("ERR_CANCELED"===(null===d||void 0===d?void 0:d.code))return;if(401==(null===d||void 0===d||null===(a=d.response)||void 0===a?void 0:a.status))s&&K({titleMessage:"Error",descriptionMessage:"Session Timeout: Please login again",messageType:"error"},(()=>R.current())),setTimeout((()=>{H("/login")}),3e3);else{if(403!==(null===d||void 0===d||null===(t=d.response)||void 0===t?void 0:t.status))return(e=>{var s,a;A.Y.info("Add Member - setErrorToaster handler"),K({titleMessage:"Error",descriptionMessage:null!==e&&void 0!==e&&null!==(s=e.response)&&void 0!==s&&null!==(a=s.data)&&void 0!==a&&a.message&&"string"===typeof e.response.data.message?e.response.data.message:"Oops! Something went wrong. Please try again later.",messageType:"error"},(()=>R.current()))})(d),[];var n,r,i,l;s&&K({titleMessage:"Error",descriptionMessage:null!==d&&void 0!==d&&null!==(n=d.response)&&void 0!==n&&null!==(r=n.data)&&void 0!==r&&r.message?null===d||void 0===d||null===(i=d.response)||void 0===i||null===(l=i.data)||void 0===l?void 0:l.message:"Oops! Something went wrong. Please try again later.",messageType:"error"},(()=>R.current())),setTimeout((()=>{H("/home")}),3e3)}}},Me=async e=>{A.Y.info("Edit Assessment - fetchMember handler");try{const s=await m.H.get(u.uX+"/member/"+e+"/master");W(s.data.map((e=>({_id:e._id,name:e.name}))))}catch(s){A.Y.info("Edit Assessment - fetchMember handler catch error")}},[Ne,Ae]=(0,l.useState)(!1),Ce=e=>{e.preventDefault()};return(0,E.jsxs)("div",{className:"page-wrapper",onClick:()=>Ne&&Ae(!1),children:[(0,E.jsx)(g.Z,{messageType:U.messageType,descriptionMessage:U.descriptionMessage,myRef:R,titleMessage:U.titleMessage}),(0,E.jsx)(j.Z,{title:(0,E.jsxs)("p",{children:['Delete Assessment "',O("title"),'"']}),info1:(0,E.jsx)("p",{children:"Deleting the assessment will be an irreversible action. All the related details would be lost."}),info2:(0,E.jsx)("p",{children:"Do you still want to continue?"}),primaryButtonText:"Delete",secondaryButtonText:"Cancel",onPrimaryModalButtonClickHandler:async()=>{try{const e=await y.Z.delete(u.IG+"".concat(null===q||void 0===q?void 0:q.id));return K({titleMessage:"Success",descriptionMessage:e.data.message,messageType:"success"},(()=>R.current())),setTimeout((()=>H("/assessment-list")),3e3)}catch(a){var e,s;if("ERR_CANCELED"===(null===a||void 0===a?void 0:a.code))return;K({titleMessage:"Error",descriptionMessage:null!==a&&void 0!==a&&null!==(e=a.responseEditMember)&&void 0!==e&&null!==(s=e.data)&&void 0!==s&&s.message&&"string"===typeof a.responseEditMember.data.message?a.responseEditMember.data.message:"Oops! Something went wrong. Please try again later.",messageType:"error"},(()=>R.current()))}finally{ie(!1)}},onSecondaryModalButtonClickHandler:()=>{H("/assessment-list")},openModal:re,setOpenModal:ie}),(0,E.jsx)("div",{className:"breadcrumb-wrapper",children:(0,E.jsx)("div",{className:"container",children:(0,E.jsxs)("ul",{className:"breadcrumb",children:[(0,E.jsx)("li",{children:(0,E.jsx)(c.rU,{to:"/assessment-list",children:"Assessments"})}),(0,E.jsx)("li",{children:"Edit Assessment"})]})})}),(0,E.jsx)("section",{children:(0,E.jsx)("div",{className:"container",children:(0,E.jsxs)("form",{onSubmit:a((async e=>{var a,t,n,r;de(!0),s(!0),A.Y.info("Edit Assessment - updateAssessment handler"),e={...e,questionnaireId:se,dueDate:new Date(new Date(new Date(null===(a=e)||void 0===a?void 0:a.dueDate).setDate(new Date(new Date(null===(t=e)||void 0===t?void 0:t.dueDate)).getDate()+1)).setHours(0,0,0,0))};let i=new FormData;i.append("questionnaireId",se),i.append("dueDate",new Date(new Date(new Date(null===(n=e)||void 0===n?void 0:n.dueDate).setDate(new Date(new Date(null===(r=e)||void 0===r?void 0:r.dueDate)).getDate())).setHours(0,0,0,0)).toISOString()),i.append("actionPlan",e.actionPlan),i.append("title",e.title),i.append("region",e.region),i.append("country",e.country),i.append("remarks",e.remarks),i.append("assignedOperationMember",e.assignedOperationMember),i.append("assignedMember",e.assignedMember),i.append("assessmentType",e.assessmentType),i.append("deleteActionPlan",e.deleteActionPlan),console.log("data ->",e);try{const e=await m.H.put(u.$v+q.id,i,{headers:{"Content-Type":"multipart/form-data"}});var l;if(200===e.status)de(!1),s(!0),K({titleMessage:"Success!",descriptionMessage:null===e||void 0===e||null===(l=e.data)||void 0===l?void 0:l.message,messageType:"success"},(()=>R.current())),Z({title:"",assessmentType:"",assignedMember:"",actionPlan:"",assignedOperationMember:"",dueDate:"",remarks:"",questionnaireId:""}),setTimeout((()=>{H("/assessment-list")}),2e3)}catch(d){A.Y.info("Edit Assessment - updateAssessment handler catch error"),de(!1),s(!1),(0,C.K)(d,K,R,H)}})),children:[(0,E.jsxs)("div",{className:"form-header flex-between",children:[(0,E.jsx)("h2",{className:"heading2",children:"Edit Assessment"}),(0,E.jsxs)("span",{className:"form-header-right-txt",onClick:()=>{Ae(!Ne)},children:[(0,E.jsx)("span",{className:"crud-operation ".concat(Ne&&"crud-operation-active"),children:(0,E.jsx)(t.Z,{})}),(0,E.jsx)("div",{className:"crud-toggle-wrap",style:{display:Ne?"block":"none"},children:(0,E.jsx)("ul",{className:"crud-toggle-list",children:(0,E.jsx)("li",{onClick:()=>ie(!0),children:"Delete"})})})]})]}),e?(0,E.jsx)(N.Z,{}):(0,E.jsx)("div",{className:"card-wrapper",children:(0,E.jsxs)("div",{className:"card-blk flex-between",children:[(0,E.jsx)("div",{className:"card-form-field",children:(0,E.jsxs)("div",{className:"form-group",children:[(0,E.jsxs)("label",{children:["Assessment Title ",(0,E.jsx)("span",{className:"mandatory",children:"*"})]}),(0,E.jsx)(h.Z,{name:"title",onBlur:e=>{var s;return P("title",null===(s=e.target.value)||void 0===s?void 0:s.trim())},control:T,myHelper:S,placeholder:"Enter assessment title",rules:{required:"true",minLength:3,maxLength:50}})]})}),(0,E.jsx)("div",{className:"card-form-field",children:(0,E.jsxs)("div",{className:"form-group",children:[(0,E.jsxs)("label",{children:["Assessment Type ",(0,E.jsx)("span",{className:"mandatory",children:"*"})]}),(0,E.jsx)(p.Z,{control:T,name:"assessmentType",placeholder:"Select assessment ",isDisabled:!0,myHelper:S,rules:{required:!0},options:X,myOnChange:e=>{A.Y.info("Edit Assessment - handleChangeForAssessmentModule handler");let s=J.filter((s=>s.name===e.target.value));P("questionnaireId",s[0]._id),ae(s[0]._id),P("assessmentType",e.target.value)}})]})}),(0,E.jsx)("div",{className:"card-form-field",children:(0,E.jsxs)("div",{className:"form-group",children:[(0,E.jsxs)("label",{children:["Member Company ",(0,E.jsx)("span",{className:"mandatory",children:"*"})]}),(0,E.jsx)(p.Z,{control:T,name:"assignedMember",myOnChange:e=>{P("assignedMember",e.target.value),"The Consumer Goods Forum"===Q.filter((s=>s._id===e.target.value))[0].name?(ne(!0),he(e.target.value,!0)):(ne(!1),he(e.target.value,!1))},placeholder:"Assign member",myHelper:S,rules:{required:!0},options:Q})]})}),(0,E.jsx)("div",{className:"card-form-field",children:(0,E.jsxs)("div",{className:"form-group",children:[(0,E.jsxs)("label",{children:["Operation Member ",(0,E.jsx)("span",{className:"mandatory",children:"*"})]}),(0,E.jsx)(p.Z,{control:T,isDisabled:!te,name:"assignedOperationMember",placeholder:"Select operation member ",myHelper:S,rules:{required:!0},options:V})]})}),(0,E.jsx)("div",{className:"card-form-field",children:(0,E.jsxs)("div",{className:"form-group",children:[(0,E.jsxs)("label",{htmlFor:"region",children:["Region",(0,E.jsx)("span",{className:"mandatory",children:"*"})]}),(0,E.jsx)(p.Z,{control:T,myOnChange:async e=>{A.Y.info("Add member - onRegionChangeHandlerAddMember handler"),P("country",""),P("region",e.target.value),_("region");const s=await be(O("region")),a=ye(s.data);F([...a])},name:"region",rules:{required:!0},placeholder:"Select region",myHelper:S,options:Y})]})}),(0,E.jsx)("div",{className:"card-form-field",children:(0,E.jsxs)("div",{className:"form-group",children:[(0,E.jsxs)("label",{htmlFor:"country",children:["Country",(0,E.jsx)("span",{className:"mandatory",children:"*"})]}),(0,E.jsx)(p.Z,{control:T,name:"country",rules:{required:!0},myOnChange:async e=>{A.Y.info("Add Member - onCountryChangeHandlerAddMember handler"),P("country",e.target.value);const s=await m.H.get(u.PO+"/".concat(e.target.value));z(s.data)},placeholder:"Select country",myHelper:S,options:B})]})}),(0,E.jsx)("div",{className:"card-form-field",children:(0,E.jsxs)("div",{className:"form-group",children:[(0,E.jsxs)("label",{children:["Due Date ",(0,E.jsx)("span",{className:"mandatory",children:"*"})]}),(0,E.jsx)(d.Qr,{name:"dueDate",control:T,render:e=>{let{field:s,fieldState:{error:a}}=e;return(0,E.jsx)(b._,{dateAdapter:f.y,children:(0,E.jsx)(i.M,{...s,disablePast:!0,className:"datepicker-blk",components:{OpenPickerIcon:x.Z},renderInput:e=>(0,E.jsx)(n.Z,{autoComplete:"off",...e,onKeyDown:Ce})})})}})]})}),(0,E.jsx)("div",{className:"card-form-field",children:(0,E.jsxs)("div",{className:"form-group",children:[(0,E.jsx)("label",{children:"Remarks/Comments"}),(0,E.jsx)(d.Qr,{name:"remarks",control:T,rules:{minLength:3,maxLength:250},render:e=>{let{field:s,fieldState:{error:a}}=e;return(0,E.jsx)(n.Z,{multiline:!0,...s,id:"outlined-basic",placeholder:"Enter remarks/comments",onBlur:e=>{var s;return P("remarks",null===(s=e.target.value)||void 0===s?void 0:s.trim())},inputProps:{maxLength:250},className:"input-textarea ".concat(a&&"input-textarea-error"),helperText:a?S.remarks[a.type]:" ",variant:"outlined"})}})]})}),(0,E.jsx)("div",{className:"card-form-field",children:(0,E.jsxs)("div",{className:"form-group",children:[(0,E.jsx)("label",{children:"Action Plan"}),(0,E.jsxs)("div",{className:"upload-file-wrap",children:[(0,E.jsx)(r.Z,{variant:"contained",component:"label",className:"upload-file-btn",children:(0,E.jsxs)("div",{className:"upload-file-blk",children:[(0,E.jsx)("input",{type:"file",hidden:!0,accept:".doc,  .pdf, .docx, .xlsx, .xls",name:"files[]",onChange:e=>{const s=e.target.files[0];if(s){const e=".".concat(s.name.split(".").pop());if(!pe.includes(e.toLowerCase()))return void K({titleMessage:"Error",descriptionMessage:"Invalid file type. Please select a valid file.",messageType:"error"},(()=>R.current()));if(s.size>10485760)return void K({titleMessage:"Error",descriptionMessage:"File size exceeds the limit of 10 MB. Please select a smaller file.",messageType:"error"},(()=>R.current()));P("actionPlan",s),P("deleteActionPlan",!1),console.log("inside if"),ue(s.name);const a=new FileReader;a.onload=e=>{var s;ce(null===e||void 0===e||null===(s=e.target)||void 0===s?void 0:s.result)},a.readAsDataURL(s)}}}),(0,E.jsx)("span",{className:"upload-icon",children:(0,E.jsx)(D.Z,{})}),(0,E.jsxs)("span",{className:"file-upload-txt",children:["Click here to choose file (max file size"," ","".concat("10"," MB"),") '.doc','.pdf','.xlsx',"]})]})}),(0,E.jsx)("p",{style:{color:"#f7a823",fontFamily:"ProximaNova-Semibold, serif, sans-serif",margin:"10px 0px"},children:"Uploading large files may take some time"}),me,(0,E.jsxs)("span",{className:"file-close-icon",style:{display:(null===me||void 0===me?void 0:me.length)>1?"inline-block":"none",cursor:"pointer"},onClick:()=>{ce(null),ue(""),P("actionPlan",""),P("deleteActionPlan",!0)},children:[" ",(0,E.jsx)(k.Z,{})]})]})]})}),(0,E.jsxs)("div",{className:"form-btn flex-between add-members-btn",children:[(0,E.jsx)("button",{type:"reset",onClick:()=>H("/assessment-list"),className:"secondary-button mr-10",children:"Cancel"}),(0,E.jsx)("button",{type:"submit",className:"primary-button add-button",disabled:le,children:"Update"})]})]})})]})})})]})}},71300:(e,s,a)=>{a.d(s,{Z:()=>c});var t=a(29823),n=a(88447),r=a(52739),i=a(60627),l=a(697),d=a(20068),o=(a(72791),a(80184));const c=e=>{var s,a,c,m,u,p;let{title:h,info1:g,info2:v,primaryButtonText:x,secondaryButtonText:f,onPrimaryModalButtonClickHandler:b,isDisabledPrimaryButton:y=!1,onSecondaryModalButtonClickHandler:j,openModal:M,setOpenModal:N,isModalForm:A,handleCloseRedirect:C,hideCloseIcon:w=!1}=e;const D=(e,s)=>{s&&"backdropClick"===s||N(!1)},k=()=>{j()};let E="";return"object"===typeof(null===h||void 0===h||null===(s=h.props)||void 0===s?void 0:s.children)?null===h||void 0===h||null===(a=h.props)||void 0===a||null===(c=a.children)||void 0===c||c.map((e=>E+=e)):E=null===h||void 0===h||null===(m=h.props)||void 0===m?void 0:m.children,(0,o.jsx)(n.Z,{"aria-labelledby":"transition-modal-title","aria-describedby":"transition-modal-description",open:M,onClose:D,closeAfterTransition:!0,disableEscapeKeyDown:!!A,BackdropComponent:r.Z,BackdropProps:{timeout:500},className:"popup-blk",children:(0,o.jsx)(i.Z,{in:M,children:(0,o.jsx)(l.Z,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4},className:"popup-box",children:(0,o.jsxs)("div",{className:"popup-innerblk",children:[(0,o.jsxs)("div",{id:"transition-modal-title",className:"popup-ttl-blk",children:[(null===(u=E)||void 0===u?void 0:u.length)<=47?(0,o.jsx)("h2",{className:"popup-ttl heading2",children:h}):(0,o.jsx)(d.Z,{title:E,children:(0,o.jsxs)("h2",{className:"popup-ttl heading2",children:[" ",null===(p=E)||void 0===p?void 0:p.slice(0,50),'..."']})}),(0,o.jsx)("span",{hidden:w,className:"popup-close-icon",onClick:A?C:D,children:(0,o.jsx)(t.Z,{})})]}),(0,o.jsx)("div",{id:"transition-modal-description",className:"popup-body",children:(0,o.jsxs)("div",{className:"popup-content-blk text-center",children:[g,A?(0,o.jsx)("form",{onSubmit:k,children:v}):v,(0,o.jsxs)("div",{className:"form-btn flex-center",children:[f&&(0,o.jsx)("button",{type:"submit",onClick:k,className:"secondary-button mr-10",children:f}),(0,o.jsx)("button",{type:"submit",onClick:()=>{b()},disabled:y,className:"primary-button",children:x})]})]})})]})})})})}},40600:(e,s,a)=>{var t=a(64836);s.Z=void 0;var n=t(a(45649)),r=a(80184),i=(0,n.default)((0,r.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM19 18H6c-2.21 0-4-1.79-4-4 0-2.05 1.53-3.76 3.56-3.97l1.07-.11.5-.95C8.08 7.14 9.94 6 12 6c2.62 0 4.88 1.86 5.39 4.43l.3 1.5 1.53.11c1.56.1 2.78 1.41 2.78 2.96 0 1.65-1.35 3-3 3zM8 13h2.55v3h2.9v-3H16l-4-4z"}),"CloudUploadOutlined");s.Z=i},52898:(e,s,a)=>{var t=a(64836);s.Z=void 0;var n=t(a(45649)),r=a(80184),i=(0,n.default)((0,r.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"}),"MoreVert");s.Z=i}}]);
//# sourceMappingURL=2517.13f7334f.chunk.js.map