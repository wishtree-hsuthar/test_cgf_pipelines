"use strict";(self.webpackChunkpr74_cgf_hrdd_web_front=self.webpackChunkpr74_cgf_hrdd_web_front||[]).push([[2172],{32172:(e,s,a)=>{a.r(s),a.d(s,{default:()=>T});var r=a(97275),n=a(94294),t=a(72791),l=a(61134),i=a(57689),d=a(11087),o=a(51514),c=a(94677),m=a(46363),u=a(48086),p=a(27181),h=a(12820),g=a(14917),v=a(27954),f=a(7792),x=a(40600),y=a(29823),b=a(36571),j=a(76218),M=a(1260),N=a(28386),S=a(45736),w=a(59434),C=a(80184);const A={title:{required:"Enter the assessment title",minLength:"minimum 3 characters required"},assessmentType:{required:"Select the assessment type"},assignedMember:{required:"Select the member company"},assignedOperationMember:{required:"Select the operation member"},dueDate:{required:"Select the due date"},region:{required:"Select the region"},country:{required:"Select the country"},remarks:{minLength:"minimum 3 characters required",maxLength:"Reached max limit"}},T=()=>{(0,M.j)("Add Assessment");const e=(0,w.v9)((e=>{var s;return null===e||void 0===e||null===(s=e.user)||void 0===s?void 0:s.userObj})),{isMemberRepresentative:s,isOperationMember:a,memberId:T}=e,[D,k]=(0,t.useState)(""),[q,O]=(0,t.useState)([]),[_,H]=(0,t.useState)([]),[P,Y]=(0,t.useState)([]),[Z,F]=(0,t.useState)([]),[E,R]=(0,t.useState)([]),I=(0,i.s0)(),L=(0,t.useRef)(),[z,B]=(0,h.Z)({titleMessage:"",descriptionMessage:"",messageType:"success"}),{handleSubmit:U,control:K,reset:Q,setValue:V,trigger:G,watch:W}=(0,l.cI)({defaultValues:{title:"",assessmentType:"",assignedMember:"",assignedOperationMember:"",dueDate:"",remarks:"",questionnaireId:"",region:"",country:"",actionPlan:""}}),[J,X]=(0,t.useState)(null),[$,ee]=(0,t.useState)(""),se=[".doc",".pdf",".docx",".xlsx",".xls"];let ae=new FormData;console.log("file in selection",J),console.log("action file in selection",null);const[re,ne]=(0,t.useState)(!1),[te,le]=(0,t.useState)([]),[ie,de]=(0,t.useState)([]),[oe,ce]=(0,t.useState)([]),[me,ue]=(0,t.useState)(!1),[pe,he]=(0,t.useState)(!1);(0,t.useEffect)((()=>{let e=!0;const r=new AbortController;ge(r,e);(async()=>{try{const n=await c.H.get(s||a?"".concat(j.e7).concat(T):j.rm,{signal:r.signal});g.Y.info("Add assessments - Fetch member companies handler"),e&&O(n.data.map((e=>({_id:e._id,name:e.companyName})))),Y(n.data)}catch(n){g.Y.info("Add assessments - Fetch member companies handler catch error")}})();return(async()=>{g.Y.info("Add assessments - Fetch questionnaires handler");try{const s=await c.H.get(j.ZW+"/master",{signal:r.signal});e&&F(s.data.map((e=>e.title))),R(s.data.map((e=>({_id:e.uuid,name:e.title}))))}catch(s){g.Y.info("Add assessments - Fetch questionnaires handler catch error",s),(0,S.K)(s,B,L,I)}})(),()=>{e=!1,r.abort()}}),[]);const ge=async(e,s)=>{try{const s=await c.H.get(j.Up,{signal:e.signal});return le(s.data),te}catch(d){var a,r;if("ERR_CANCELED"===(null===d||void 0===d?void 0:d.code))return;if(401==(null===d||void 0===d||null===(a=d.response)||void 0===a?void 0:a.status))s&&B({titleMessage:"Error",descriptionMessage:"Session Timeout: Please login again",messageType:"error"},(()=>L.current())),setTimeout((()=>{I("/login")}),3e3);else{if(403!==(null===d||void 0===d||null===(r=d.response)||void 0===r?void 0:r.status))return(e=>{var s,a;g.Y.info("Add Member - setErrorToaster handler"),B({titleMessage:"Error",descriptionMessage:null!==e&&void 0!==e&&null!==(s=e.response)&&void 0!==s&&null!==(a=s.data)&&void 0!==a&&a.message&&"string"===typeof e.response.data.message?e.response.data.message:"Oops! Something went wrong. Please try again later.",messageType:"error"},(()=>L.current()))})(d),[];var n,t,l,i;s&&B({titleMessage:"Error",descriptionMessage:null!==d&&void 0!==d&&null!==(n=d.response)&&void 0!==n&&null!==(t=n.data)&&void 0!==t&&t.message?null===d||void 0===d||null===(l=d.response)||void 0===l||null===(i=l.data)||void 0===i?void 0:i.message:"Oops! Something went wrong. Please try again later.",messageType:"error"},(()=>L.current())),setTimeout((()=>{I("/home")}),3e3)}}},ve=async(e,s)=>{g.Y.info("Add assessments - Fetch operation member handler");try{var a,r;const n=await c.H.get(s?j.C+e+"/master/internal":j.C+e+"/master");H(n.data.map((e=>({_id:e._id,name:e.name}))));let t=n.data.filter((e=>null===e||void 0===e?void 0:e.isMemberRepresentative));V("assignedOperationMember",s?"":null!==(a=t[0])&&void 0!==a&&a._id?null===(r=t[0])||void 0===r?void 0:r._id:"")}catch(n){g.Y.info("Add assessments - Fetch operation member handler catch error")}},fe=e=>{e.preventDefault()};return(0,C.jsxs)("div",{className:"page-wrapper",children:[(0,C.jsx)(p.Z,{messageType:z.messageType,descriptionMessage:z.descriptionMessage,myRef:L,titleMessage:z.titleMessage}),(0,C.jsx)("div",{className:"breadcrumb-wrapper",children:(0,C.jsx)("div",{className:"container",children:(0,C.jsxs)("ul",{className:"breadcrumb",children:[(0,C.jsx)("li",{children:(0,C.jsx)(d.rU,{to:"/assessment-list",children:"Assessments"})}),(0,C.jsx)("li",{children:"Add Assessment"})]})})}),(0,C.jsx)("section",{children:pe?(0,C.jsx)(N.Z,{}):(0,C.jsx)("div",{className:"container",children:(0,C.jsxs)("form",{onSubmit:U((async e=>{g.Y.info("Add assessments - submitAssessments"),ue(!0),console.log("file =",J);let s=new Date(e.dueDate).setDate(new Date(e.dueDate).getDate()+1);console.log("data while add =>",e),ae.append("actionPlan",e.actionPlan),ae.append("actionPlanName",$),ae.append("dueDate",new Date(new Date(s).setHours(0,0,0,0)).toISOString()),ae.append("title",null===e||void 0===e?void 0:e.title),ae.append("assessmentType",null===e||void 0===e?void 0:e.assessmentType),ae.append("assignedMember",null===e||void 0===e?void 0:e.assignedMember),ae.append("assignedOperationMember",null===e||void 0===e?void 0:e.assignedOperationMember),ae.append("remarks",null===e||void 0===e?void 0:e.remarks),ae.append("questionnaireId",null===e||void 0===e?void 0:e.questionnaireId),ae.append("region",null===e||void 0===e?void 0:e.region),ae.append("country",null===e||void 0===e?void 0:e.country),he(!0);try{const e=await c.H.post(j.cj,ae,{headers:{"Content-Type":"multipart/form-data"}});201===e.status&&(he(!1),ue(!1),Q({title:"",assessmentType:"",assignedMember:"",assignedOperationMember:"",dueDate:"",remarks:"",questionnaireId:""}),B({titleMessage:"Success!",descriptionMessage:e.data.message,messageType:"success"},(()=>L.current())),setTimeout((()=>{I("/assessment-list")}),2e3))}catch(a){g.Y.info("Add assessments - submitAssessments catch error"),ue(!1),(0,S.K)(a,B,L,I)}he(!1)})),children:[(0,C.jsx)("div",{className:"form-header flex-between",children:(0,C.jsx)("h2",{className:"heading2",children:"Add Assessment"})}),(0,C.jsx)("div",{className:"card-wrapper",children:(0,C.jsxs)("div",{className:"card-blk flex-between",children:[(0,C.jsx)("div",{className:"card-form-field",children:(0,C.jsxs)("div",{className:"form-group",children:[(0,C.jsxs)("label",{children:["Assessment Title ",(0,C.jsx)("span",{className:"mandatory",children:"*"})]}),(0,C.jsx)(u.Z,{name:"title",control:K,onBlur:e=>{var s;return V("title",null===(s=e.target.value)||void 0===s?void 0:s.trim())},myHelper:A,placeholder:"Enter assessment title",rules:{required:"true",minLength:3,maxLength:50}})]})}),(0,C.jsx)("div",{className:"card-form-field",children:(0,C.jsxs)("div",{className:"form-group",children:[(0,C.jsxs)("label",{children:["Assessment Type ",(0,C.jsx)("span",{className:"mandatory",children:"*"})]}),(0,C.jsx)(m.Z,{control:K,name:"assessmentType",placeholder:"Select assessment type",myHelper:A,rules:{required:!0},options:Z,myOnChange:e=>{g.Y.info("Add assessments - handleChangeForAssessmentModule hanler");e.target.value;let s=E.filter((s=>s.name===e.target.value));V("questionnaireId",s[0]._id),V("assessmentType",e.target.value),G("assessmentType")}})]})}),(0,C.jsx)("div",{className:"card-form-field",children:(0,C.jsxs)("div",{className:"form-group",children:[(0,C.jsxs)("label",{children:["Member Company ",(0,C.jsx)("span",{className:"mandatory",children:"*"})]}),(0,C.jsx)(m.Z,{control:K,name:"assignedMember",placeholder:"Select member company",options:q,myHelper:A,myOnChange:async e=>{g.Y.info("Add assessments - HandleChangeForMemberCompany handler"),V("assignedMember",e.target.value);let s=q.filter((s=>s._id===e.target.value));P.filter((s=>s._id===e.target.value));"The Consumer Goods Forum"===s[0].name?(ne(!0),await ve(e.target.value,!0)):(ne(!1),await ve(e.target.value,!1),G("assignedOperationMember")),G("assignedMember")},rules:{required:!0}})]})}),(0,C.jsx)("div",{className:"card-form-field",children:(0,C.jsxs)("div",{className:"form-group",children:[(0,C.jsxs)("label",{children:["Operation Member ",(0,C.jsx)("span",{className:"mandatory",children:"*"})]}),(0,C.jsx)(m.Z,{control:K,isDisabled:!re,name:"assignedOperationMember",options:_,placeholder:"Select operation member ",myHelper:A,rules:{required:!0}})]})}),(0,C.jsx)("div",{className:"card-form-field",children:(0,C.jsxs)("div",{className:"form-group",children:[(0,C.jsxs)("label",{htmlFor:"region",children:["Region",(0,C.jsx)("span",{className:"mandatory",children:"*"})]}),(0,C.jsx)(m.Z,{control:K,myOnChange:async e=>{g.Y.info("Add member - onRegionChangeHandlerAddMember handler"),V("country",""),V("region",e.target.value),G("region");const s=await(async e=>{g.Y.info("Add member - getCountriesAddMember handler");try{return await c.H.get(j.rF+"/".concat(e))}catch(r){var s,a;if("ERR_CANCELED"===(null===r||void 0===r?void 0:r.code))return;return g.Y.info("Add member - getCountriesAddMember handler catch error - ".concat(null===r||void 0===r||null===(s=r.response)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.message," ")),[]}})(W("region")),a=((r=s.data).forEach(((e,s)=>r[s]=e.hasOwnProperty("_id")?e.name:e)),r);var r;de([...a])},name:"region",rules:{required:!0},placeholder:"Select region",myHelper:A,options:te})]})}),(0,C.jsx)("div",{className:"card-form-field",children:(0,C.jsxs)("div",{className:"form-group",children:[(0,C.jsxs)("label",{htmlFor:"country",children:["Country",(0,C.jsx)("span",{className:"mandatory",children:" *"})]}),(0,C.jsx)(m.Z,{control:K,name:"country",rules:{required:!0},myOnChange:async e=>{g.Y.info("Add Member - onCountryChangeHandlerAddMember handler"),V("country",e.target.value);const s=await c.H.get(j.PO+"/".concat(e.target.value));ce(s.data)},placeholder:"Select country",myHelper:A,options:ie})]})}),(0,C.jsx)("div",{className:"card-form-field",children:(0,C.jsxs)("div",{className:"form-group",children:[(0,C.jsxs)("label",{children:["Due Date ",(0,C.jsx)("span",{className:"mandatory",children:"*"})]}),(0,C.jsx)(l.Qr,{name:"dueDate",control:K,rules:{required:!0},render:e=>{let{field:s,fieldState:{error:a}}=e;return(0,C.jsx)(b._,{dateAdapter:f.y,children:(0,C.jsx)(o.M,{disablePast:!0,className:"datepicker-blk",components:{OpenPickerIcon:v.Z},value:D,onChange:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";k(e),V("dueDate",null===e||void 0===e?void 0:e.toISOString()),G("dueDate")},renderInput:e=>(0,C.jsx)(r.Z,{autoComplete:"off",...e,className:" input-field ".concat(a&&"input-error"),onKeyDown:fe,placeholder:"MM/DD/YYYY",error:!0,helperText:a?A.dueDate[a.type]:" "})})})}})]})}),(0,C.jsx)("div",{className:"card-form-field",children:(0,C.jsxs)("div",{className:"form-group",children:[(0,C.jsx)("label",{children:"Remarks/Comments"}),(0,C.jsx)(l.Qr,{name:"remarks",control:K,rules:{minLength:3,maxLength:250},render:e=>{let{field:s,fieldState:{error:a}}=e;return(0,C.jsx)(r.Z,{multiline:!0,...s,onBlur:e=>{var s;return V("remarks",null===(s=e.target.value)||void 0===s?void 0:s.trim())},inputProps:{maxLength:250},className:"input-textarea ".concat(a&&"input-textarea-error"),id:"outlined-basic",placeholder:"Enter remarks/comments",helperText:a?A.remarks[a.type]:" ",variant:"outlined"})}})]})}),(0,C.jsx)("div",{className:"card-form-field",children:(0,C.jsxs)("div",{className:"form-group",children:[(0,C.jsx)("label",{children:"Action Plan"}),(0,C.jsxs)("div",{className:"upload-file-wrap",children:[(0,C.jsx)(n.Z,{variant:"contained",component:"label",className:"upload-file-btn",children:(0,C.jsxs)("div",{className:"upload-file-blk",children:[(0,C.jsx)("input",{type:"file",hidden:!0,accept:".doc,  .pdf, .docx, .xlsx, .xls",name:"files[]",onChange:e=>{const s=e.target.files[0];if(s){const a=".".concat(s.name.split(".").pop());if(!se.includes(a.toLowerCase()))return void B({titleMessage:"error!",descriptionMessage:"Invalid file type. Please select a valid file.",messageType:"error"},(()=>L.current()));if(s.size>10485760)return void B({titleMessage:"error!",descriptionMessage:"File size exceeds the limit of 10 MB. Please select a smaller file.",messageType:"error"},(()=>L.current()));V("actionPlan",e.target.files[0]),console.log("inside if"),ee(s.name);(new FileReader).onload=e=>{var s;X(null===e||void 0===e||null===(s=e.target)||void 0===s?void 0:s.result)}}}}),(0,C.jsx)("span",{className:"upload-icon",children:(0,C.jsx)(x.Z,{})}),(0,C.jsxs)("span",{className:"file-upload-txt",children:["Click here to choose file (max file size"," ","".concat("10"," MB"),") '.doc','.pdf','.xlsx',"]})]})}),(0,C.jsx)("p",{style:{color:"#f7a823",fontFamily:"ProximaNova-Semibold, serif, sans-serif",margin:"10px 0px"},children:"Uploading large files may take some time"}),$,(0,C.jsxs)("span",{className:"file-close-icon",style:{display:$.length>1?"inline-block":"none",cursor:"pointer"},onClick:()=>{X(null),ee(""),ae.delete("actionPlan"),ae.delete("actionPlanName")},children:[" ",(0,C.jsx)(y.Z,{})]})]})]})}),(0,C.jsxs)("div",{className:"form-btn flex-between add-members-btn",children:[(0,C.jsx)("button",{type:"reset",onClick:()=>I("/assessment-list"),className:"secondary-button mr-10",children:"Cancel"}),(0,C.jsx)("button",{type:"submit",className:"primary-button add-button",disabled:me,children:"Save"})]})]})})]})})})]})}},40600:(e,s,a)=>{var r=a(64836);s.Z=void 0;var n=r(a(45649)),t=a(80184),l=(0,n.default)((0,t.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM19 18H6c-2.21 0-4-1.79-4-4 0-2.05 1.53-3.76 3.56-3.97l1.07-.11.5-.95C8.08 7.14 9.94 6 12 6c2.62 0 4.88 1.86 5.39 4.43l.3 1.5 1.53.11c1.56.1 2.78 1.41 2.78 2.96 0 1.65-1.35 3-3 3zM8 13h2.55v3h2.9v-3H16l-4-4z"}),"CloudUploadOutlined");s.Z=l}}]);
//# sourceMappingURL=2172.ce88bd6b.chunk.js.map